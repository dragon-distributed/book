# 区块链的一些机制 - 从Double Spend(双花攻击)问题说起

(本文属于原创内容，首发于https://github.com/dragon-distributed/book , 未经作者许可，不得转载。) 

## 概述

本文从经典的双花攻击问题说起，尝试解析清楚：  
1) 什么是双花攻击（举列说明）  
2) 为什么PoW能有效地防止双花攻击  
3) 为什么只要算力不超50%，attacker将很难发起双花攻击  

为了简单描述，我们用"longest chain"作为主链选择算法，BTC作为描述的区块链。


## 什么是双花攻击

假设Alice想从Bob中购买别墅，并通过BTC交易，价格是100个比特币。Alice在BTC中支付了100比特币，Bob等了6个区块后，Bob将别墅过户了。如下图：  

![图1](https://longdandan-1256672193.cos.ap-guangzhou.myqcloud.com/article/blockchain/2.normal.jpg)

Alice看完黑客帝国后，她就在想，既然使用"longest chain"的方式，那么只要我能构造出比现有mainnet更长的chain，这个chain不包含这次的别墅交易，并将这个chain广播到mainnet上，那么，之前的block就无效了。思路如下图：  

![图2](https://longdandan-1256672193.cos.ap-guangzhou.myqcloud.com/article/blockchain/2.attack.jpg)

如上图，attack关键在于**=="构造出更长的chain"。==** 

为什么叫双花呢？只要之前Alice的交易无效的话，那么这一笔钱，就可以用于其它消费了，相当于消费了两次。

## 为什么PoW能有效地防止双花攻击 

Alice买来了服务器，开始了attack。但突然发现，她要生成block，需要大量地计算hash，并碰撞出有效的hash，才能生成正确区块。理想是丰满的，但现实是骨感的，她发现自己的服务器，要几个小时才能算出一个hash，但mainnet上平均10分钟就能算出一个有效的hash。这次子的话，她就永远无法快过mainnet了。  

**这就是为什么PoW能有效地防止双花攻击的原因，一般的攻击者，没有足够的算力，无法比主网更快地生成block**

## 为什么只要算力不超50%，attacker将很难发起双花攻击

双花攻击的核心是"更快地生成更长的链"(longest chain场景)，而使用PoW共识算法的区块链，只要attacker算力不如正常的链，则无法更快地生成自己想要的链，自然就无法攻击了。大家平常看到的51% attack就是这个意思，因为只要某个人或组织，有超过50%的算力，就随便他们怎么玩了。